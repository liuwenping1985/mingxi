<?xml version="1.0" encoding="UTF-8"?>
<sqlcfg>
	<report>
		<WorkDailyStatistics>
			<main>
				<rpt>
					<!-- *******协同******* -->
					<!-- 已办 -->
					<collaboration1>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  ca.APP,
					  0,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM ctp_affair ca INNER JOIN org_member m
					 ON ca.MEMBER_ID=m.ID
					 AND m.IS_DELETED = 0
					 AND m.IS_ENABLE = 1
					 AND m.IS_ADMIN = 0
					 AND m.IS_ASSIGNED = 1
					 AND m.IS_VIRTUAL = 0
					 AND m.IS_LOGINABLE = 1
					 AND m.IS_INTERNAL = 1
					WHERE ca.app IN(1,19,20,21)
					    AND ca.state = 4
					         AND to_char(ca.complete_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					         AND to_char(ca.complete_time,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY m.ORG_DEPARTMENT_ID,ca.APP
					]]>
					</collaboration1>
					<!-- 已发 -->
					<collaboration2>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  ca.APP,
					  1,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM ctp_affair ca INNER JOIN org_member m
					 ON ca.MEMBER_ID=m.ID
					 AND m.IS_DELETED = 0
					 AND m.IS_ENABLE = 1
					 AND m.IS_ADMIN = 0
					 AND m.IS_ASSIGNED = 1
					 AND m.IS_VIRTUAL = 0
					 AND m.IS_LOGINABLE = 1
					 AND m.IS_INTERNAL = 1
					WHERE ca.app IN(1,19,20,21)
					    AND (ca.state = 2
					         AND to_char(ca.create_date,'yyyy-mm-dd hh:MM:ss') >= :startTime
					         AND to_char(ca.create_date,'yyyy-mm-dd hh:MM:ss') < :endTime)
					GROUP BY m.ORG_DEPARTMENT_ID,ca.APP
					]]>
					</collaboration2>
					<!-- 待办 -->
					<collaboration3>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  ca.APP,
					  2,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM ctp_affair ca INNER JOIN org_member m
					 ON ca.MEMBER_ID=m.ID
					 AND m.IS_DELETED = 0
					 AND m.IS_ENABLE = 1
					 AND m.IS_ADMIN = 0
					 AND m.IS_ASSIGNED = 1
					 AND m.IS_VIRTUAL = 0
					 AND m.IS_LOGINABLE = 1
					 AND m.IS_INTERNAL = 1
					WHERE ca.app IN(1,19,20,21)
					    AND (ca.state = 3 AND CA.OBJECT_ID<>-1 AND CA.SUB_OBJECT_ID<>-1 
					    	 AND ca.archive_id IS NULL
					         AND to_char(ca.receive_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					         AND to_char(ca.receive_time,'yyyy-mm-dd hh:MM:ss') < :endTime)
					GROUP BY m.ORG_DEPARTMENT_ID,ca.APP
					]]>
					</collaboration3>
					<!-- 暂存待办 -->
					<collaboration4>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  ca.APP,
					  3,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM ctp_affair ca INNER JOIN org_member m
					 ON ca.MEMBER_ID=m.ID
					 AND m.IS_DELETED = 0
					 AND m.IS_ENABLE = 1
					 AND m.IS_ADMIN = 0
					 AND m.IS_ASSIGNED = 1
					 AND m.IS_VIRTUAL = 0
					 AND m.IS_LOGINABLE = 1
					 AND m.IS_INTERNAL = 1
					WHERE ca.app IN(1,19,20,21)
					    AND (ca.state = 3 AND CA.OBJECT_ID<>-1 AND CA.SUB_OBJECT_ID<>-1 
					         AND to_char(ca.receive_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					         AND to_char(ca.receive_time,'yyyy-mm-dd hh:MM:ss') < :endTime)
					    AND ca.sub_state = 13
					GROUP BY m.ORG_DEPARTMENT_ID,ca.APP
					]]>
					</collaboration4>
					<!-- 已归档 -->
					<collaboration5>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  ca.APP,
					  16,
					  :startTime AS queryTime,
					  COUNT(DISTINCT doc.ID)
					FROM doc_resources doc 
					 INNER JOIN ctp_affair ca 
					 ON  (CASE WHEN ca.APP=1 AND ca.id=doc.SOURCE_ID THEN 1
							WHEN ca.APP in(19,20,21) AND ca.OBJECT_ID=doc.SOURCE_ID THEN 1
							ELSE 0 END)=1
					 INNER JOIN org_member m
					 ON doc.create_user_id=m.ID
					 AND m.IS_DELETED = 0
					 AND m.IS_ENABLE = 1
					 AND m.IS_ADMIN = 0
					 AND m.IS_ASSIGNED = 1
					 AND m.IS_VIRTUAL = 0
					 AND m.IS_LOGINABLE = 1
					 AND m.IS_INTERNAL = 1
					WHERE doc.mime_type_id in (1,2)
					    AND to_char(doc.create_time,'yyyy-mm-dd hh:MM:ss') < :endTime
					    AND to_char(doc.create_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					GROUP BY m.ORG_DEPARTMENT_ID,ca.APP
					]]>
					</collaboration5>
					<!-- ********会议******** -->
					<!-- 已发 -->
					<meeting1>
					<![CDATA[
					SELECT
					  om.ORG_DEPARTMENT_ID,
					  0,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM meeting m INNER JOIN org_member om
					 ON  m.create_user=om.ID
					 AND om.IS_DELETED = 0
					 AND om.IS_ENABLE = 1
					 AND om.IS_ADMIN = 0
					 AND om.IS_ASSIGNED = 1
					 AND om.IS_VIRTUAL = 0
					 AND om.IS_LOGINABLE = 1
					 AND om.IS_INTERNAL = 1
					WHERE (CASE 
							WHEN update_date IS NULL THEN to_char(m.create_date,'yyyy-mm-dd hh:MM:ss') >= :startTime AND to_char(m.create_date,'yyyy-mm-dd hh:MM:ss') < :endTime
					        ELSE to_char(m.update_date,'yyyy-mm-dd hh:MM:ss') >= :startTime AND to_char(m.update_date,'yyyy-mm-dd hh:MM:ss') < :endTime
					      END)
					    AND m.state != 0 AND m.room_state !=0 AND m.room_state!=2
					GROUP BY om.ORG_DEPARTMENT_ID
					]]>
					</meeting1>
					<!-- 已办 -->
					<meeting2>
					<![CDATA[
					SELECT
					  om.ORG_DEPARTMENT_ID,
					  1,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM ctp_affair AS m
					  INNER JOIN meeting mt
					    ON mt.id = m.object_id
					  INNER JOIN org_member om
					    ON m.member_id = om.ID
					      AND om.IS_DELETED = 0
					      AND om.IS_ENABLE = 1
					      AND om.IS_ADMIN = 0
					      AND om.IS_ASSIGNED = 1
					      AND om.IS_VIRTUAL = 0
					      AND om.IS_LOGINABLE = 1
					      AND om.IS_INTERNAL = 1
					WHERE m.app = 6
					    AND m.sub_app = 5
					    AND m.state = 4
					    AND mt.state in (30, -10) 
					    AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY om.ORG_DEPARTMENT_ID
					]]>
					</meeting2>
					<!-- 待开 -->
					<meeting3>
					<![CDATA[
					SELECT
					  om.ORG_DEPARTMENT_ID,
					  2,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM ctp_affair m
					  INNER JOIN meeting mt
					    ON mt.id = m.object_id
					  INNER JOIN org_member om
					    ON m.member_id = om.ID
					      AND om.IS_DELETED = 0
					      AND om.IS_ENABLE = 1
					      AND om.IS_ADMIN = 0
					      AND om.IS_ASSIGNED = 1
					      AND om.IS_VIRTUAL = 0
					      AND om.IS_LOGINABLE = 1
					      AND om.IS_INTERNAL = 1
					WHERE m.app = 6
					    AND m.sub_app = 5
					    AND (m.state = 3
					         AND m.sub_state != 32)
					    AND ((to_char(mt.begin_date,'yyyy-mm-dd hh:MM:ss') >= :startTime
					          AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') <= :endTime)
					          OR (to_char(mt.begin_date,'yyyy-mm-dd hh:MM:ss') <= :startTime
					              AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') >= :startTime)
					          OR (to_char(mt.begin_date,'yyyy-mm-dd hh:MM:ss') < :endTime
					              AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') >= :endTime))
					GROUP BY om.ORG_DEPARTMENT_ID
					]]>
					</meeting3>
					<!-- 已归档 -->
					<meeting4>
					<![CDATA[
					SELECT
					  om.ORG_DEPARTMENT_ID,
					  3,
					  :startTime as querytime,
					  COUNT(*)
					FROM meeting m
					  JOIN doc_resources doc
					    ON m.id = doc.source_id
					  INNER JOIN org_member om
					    ON m.create_user = om.ID
					      AND om.IS_DELETED = 0
					      AND om.IS_ENABLE = 1
					      AND om.IS_ADMIN = 0
					      AND om.IS_ASSIGNED = 1
					      AND om.IS_VIRTUAL = 0
					      AND om.IS_LOGINABLE = 1
					      AND om.IS_INTERNAL = 1
					WHERE m.state =  - 10
					    AND to_char(doc.create_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(doc.create_time,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY om.ORG_DEPARTMENT_ID
					]]>
					</meeting4>
					<!-- 未回执 -->
					<meeting5>
					<![CDATA[
					SELECT
					  om.ORG_DEPARTMENT_ID,
					  4,
					  :startTime as querytime,
					  COUNT(*)
					FROM ctp_affair m
					  INNER JOIN meeting mt
					    ON m.object_id = mt.id
					  INNER JOIN org_member om
					    ON m.member_id = om.ID
					      AND om.IS_DELETED = 0
					      AND om.IS_ENABLE = 1
					      AND om.IS_ADMIN = 0
					      AND om.IS_ASSIGNED = 1
					      AND om.IS_VIRTUAL = 0
					      AND om.IS_LOGINABLE = 1
					      AND om.IS_INTERNAL = 1
					WHERE m.app = 6
					    AND m.sub_app = 5
					    AND (m.sub_state = 11
					          OR m.sub_state = 12)
					    AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY om.ORG_DEPARTMENT_ID
					]]>
					</meeting5>
					<!-- 已回执 -->
					<meeting6>
					<![CDATA[
					SELECT
					  om.ORG_DEPARTMENT_ID,
					  5,
					  :startTime as querytime,
					  COUNT(*)
					FROM ctp_affair AS m
					  INNER JOIN meeting mt
					    ON m.object_id = mt.id
					  INNER JOIN org_member om
					    ON m.member_id = om.ID
					      AND om.IS_DELETED = 0
					      AND om.IS_ENABLE = 1
					      AND om.IS_ADMIN = 0
					      AND om.IS_ASSIGNED = 1
					      AND om.IS_VIRTUAL = 0
					      AND om.IS_LOGINABLE = 1
					      AND om.IS_INTERNAL = 1
					WHERE m.app = 6
					    AND m.sub_app = 5
					    AND (m.sub_state = 31
					          OR m.sub_state = 32
					          OR m.sub_state = 33)
					    AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(mt.end_date,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY om.ORG_DEPARTMENT_ID
					]]>
					</meeting6>
					<!-- ********计划******** -->
					<!-- 已发布 -->
					<plan1>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  0,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM plan_info p INNER JOIN org_member m
					 ON p.create_user_id=m.ID
					 AND m.IS_DELETED = 0
					 AND m.IS_ENABLE = 1
					 AND m.IS_ADMIN = 0
					 AND m.IS_ASSIGNED = 1
					 AND m.IS_VIRTUAL = 0
					 AND m.IS_LOGINABLE = 1
					 AND m.IS_INTERNAL = 1
					WHERE p.status != 1
					    AND to_char(p.create_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(p.create_time,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY m.ORG_DEPARTMENT_ID
					]]>
					</plan1>
					<!-- 已接收 -->
					<plan2>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  1,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM plan_info p
					  INNER JOIN plan_relevant_user pu
					    ON p.id = pu.ref_plan_id
					  INNER JOIN org_member m
					    ON pu.ref_user_id = m.ID
					      AND m.IS_DELETED = 0
					      AND m.IS_ENABLE = 1
					      AND m.IS_ADMIN = 0
					      AND m.IS_ASSIGNED = 1
					      AND m.IS_VIRTUAL = 0
					      AND m.IS_LOGINABLE = 1
					      AND m.IS_INTERNAL = 1
					WHERE p.status != 1
					    AND pu.type != '4'
					    AND to_char(p.create_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(p.create_time,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY m.ORG_DEPARTMENT_ID
					]]>
					</plan2>
					<!-- 已回复 -->
					<plan3>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  2,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM ctp_comment_all a
					  INNER JOIN plan_info p
					    ON a.module_id = p.id
					  INNER JOIN org_member m
					    ON a.create_id = m.ID
					      AND m.IS_DELETED = 0
					      AND m.IS_ENABLE = 1
					      AND m.IS_ADMIN = 0
					      AND m.IS_ASSIGNED = 1
					      AND m.IS_VIRTUAL = 0
					      AND m.IS_LOGINABLE = 1
					      AND m.IS_INTERNAL = 1
					WHERE a.module_type = 5
					    AND p.status != 1 and a.pid=0 
					    AND to_char(a.create_date,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(a.create_date,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY m.ORG_DEPARTMENT_ID
					]]>
					</plan3>
					<!-- 未回复 -->
					<plan4>
					<![CDATA[
					SELECT
					  m.ORG_DEPARTMENT_ID,
					  3,
					  :startTime AS queryTime,
					  COUNT(*)
					FROM plan_info p
					  INNER JOIN plan_relevant_user pu
					    ON p.id = pu.ref_plan_id
					  INNER JOIN org_member m
					    ON pu.ref_user_id = m.ID
					      AND m.IS_DELETED = 0
					      AND m.IS_ENABLE = 1
					      AND m.IS_ADMIN = 0
					      AND m.IS_ASSIGNED = 1
					      AND m.IS_VIRTUAL = 0
					      AND m.IS_LOGINABLE = 1
					      AND m.IS_INTERNAL = 1
					WHERE p.status != 1
					    AND pu.process !=1
					    AND pu.type = 1
					    AND to_char(p.create_time,'yyyy-mm-dd hh:MM:ss') >= :startTime
					    AND to_char(p.create_time,'yyyy-mm-dd hh:MM:ss') < :endTime
					GROUP BY m.ORG_DEPARTMENT_ID
					]]>
					</plan4>
					<task>
					<![CDATA[
					select
					m.ORG_DEPARTMENT_ID,
					ti.status,
					:startTime AS queryTime,
						sum(*) as total
					from task_info ti 
					inner join task_role tr 
					on ti.id = tr.task_id 
					INNER JOIN ORG_MEMBER m
					ON tr.role_id=m.id
						AND m.IS_DELETED = 0
						AND m.IS_ENABLE = 1
						AND m.IS_ADMIN = 0
						AND m.IS_ASSIGNED = 1
						AND m.IS_VIRTUAL = 0
						AND m.IS_LOGINABLE = 1
						AND m.IS_INTERNAL = 1
					where tr.role_type > 0 
					AND 
						to_char(ti.planned_start_time,'yyyy-mm-dd hh:MM:ss') <= :startTime AND to_char(ti.planned_end_time,'yyyy-mm-dd hh:MM:ss') >= :startTime)
						OR to_char(ti.planned_start_time,'yyyy-mm-dd hh:MM:ss') >= :startTime AND to_char(ti.planned_end_time,'yyyy-mm-dd hh:MM:ss') <= :endTime)
						OR to_char(ti.planned_start_time,'yyyy-mm-dd hh:MM:ss') < :endTime AND to_char(ti.planned_end_time,'yyyy-mm-dd hh:MM:ss') >= :endTime)
						)
					GROUP BY TI.STATUS,m.ORG_DEPARTMENT_ID
					]]>
					</task>
					<task2>
					<![CDATA[
					SELECT
					m.ORG_DEPARTMENT_ID,
					6,
					:startTime AS queryTime,
					COUNT(DISTINCT TI.id) AS numbers
					FROM task_info ti INNER JOIN task_role tr
					ON ti.id = tr.task_id
					INNER JOIN org_member m
										ON m.ID=ti.create_user
											AND m.IS_DELETED = 0
											AND m.IS_ENABLE = 1
											AND m.IS_ADMIN = 0
											AND m.IS_ASSIGNED = 1
											AND m.IS_VIRTUAL = 0
											AND m.IS_LOGINABLE = 1
											AND m.IS_INTERNAL = 1
					WHERE ti.STATUS<5 AND tr.role_type = 0
					and to_char(ti.create_time,'yyyy-mm-dd hh:MM:ss')>=:startTime AND to_char(ti.create_time,'yyyy-mm-dd hh:MM:ss')<:endTime
					GROUP BY m.ORG_DEPARTMENT_ID
					]]>
					</task2>
					<task3>
					<![CDATA[
					SELECT
					m.ORG_DEPARTMENT_ID,
					7,
					:startTime AS queryTime,
					COUNT(DISTINCT TI.id) AS numbers
					FROM task_info ti INNER JOIN task_role tr
					ON ti.id = tr.task_id
					INNER JOIN org_member m
										ON m.ID=ti.create_user
											AND m.IS_DELETED = 0
											AND m.IS_ENABLE = 1
											AND m.IS_ADMIN = 0
											AND m.IS_ASSIGNED = 1
											AND m.IS_VIRTUAL = 0
											AND m.IS_LOGINABLE = 1
											AND m.IS_INTERNAL = 1
					WHERE ti.STATUS in(1,2,3) AND tr.role_type > 0 
					GROUP BY m.ORG_DEPARTMENT_ID
					]]>
					</task3>
				</rpt>
			</main>
		</WorkDailyStatistics>
		<EventStatistics>
			<main>
				<rpt>
					<event>
					<![CDATA[SELECT * FROM cal_event where 1!=1]]>
					</event>
					<plan>
					<![CDATA[SELECT * FROM plan_info where 1!=1]]>
					</plan>
					<task>
					<![CDATA[SELECT * FROM task_info where 1!=1]]>
					</task>
					<meeting>
					<![CDATA[SELECT * FROM meeting where 1!=1]]>
					</meeting>
				</rpt>
			</main>
		</EventStatistics>
	</report>
</sqlcfg>