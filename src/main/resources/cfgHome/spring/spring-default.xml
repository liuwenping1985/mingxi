<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
   http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">



	<aop:config  proxy-target-class="true">

		<aop:pointcut id="apiPCD" expression="bean(*Api) &amp;&amp; execution(* com.seeyon.*..*.*(..))" />
		<aop:advisor advice-ref="txAdvice" pointcut-ref="apiPCD" />

		<!--
        <aop:pointcut id="appServiceMethods" expression="execution(* com.seeyon.apps..*.*(..))" />
        <aop:pointcut id="ctpServiceMethods" expression="execution(* com.seeyon.ctp..*.*(..))" />
        <aop:advisor advice-ref="txAdvice" pointcut-ref="appServiceMethods" />
        <aop:advisor advice-ref="txAdvice" pointcut-ref="ctpServiceMethods" />
         -->
	</aop:config>

	<bean id="managerAdvisor" class="org.springframework.aop.support.DefaultPointcutAdvisor">
		<property name="advice" ref="txAdvice" />
		<property name="pointcut" ref="managerPointcut" />
	</bean>

	<bean id="managerPointcut" class="org.springframework.aop.aspectj.CTPAspectJExpressionPointcut">
		<property name="expression">
			<value>bean(*Manager) &amp;&amp; execution(* com.seeyon.*..*.*(..))</value>
		</property>
	</bean>

	<tx:advice id="txAdvice" transaction-manager="transactionManager">
		<tx:attributes>
			<tx:method name="transfer*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="translate*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="translateV3xOrgMemberToWebV3xOrgMember*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="translateFormFieldValieDisplayInfo*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transBeforeInvokeWorkFlow*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transferTemplate*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transShowSummary*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transUpdateCurrentInfo*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transContentNewResponse*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transContentSaveOrUpdateWithoutDB*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transDoLogin*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transDoLogout*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateOnlineState*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transInitChartData*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="loadMore*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transPendingMain*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="export*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addToIndex*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="decryptionFile*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="upload*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="iSearch*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="summary*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="componentPage*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="showDiagram*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="lockWorkflow*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="canWorkflowCurrentNodeSubmit*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="colDelLock*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="formAddLock*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="loginUC*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="init*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="listenEvent*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addAuthView*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addDownlaodRecord*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addEditForm*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addField*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addFormBean*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addFormReportBean*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addFormSerialNumberBean*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addOrDelDataSubBean*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addQuery*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addTable*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addTrigger*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addView*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="deleteTrigger4Cache*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="onFieldInfoChange*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveBaseInfo*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveFormBeanSet4Cache*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveOrUpdateAuth*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveOrupdateAuthBind*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveOrUpdateCodeAndLogs*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveOrUpdateFillBackSet*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveOrUpdateRelationForm*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveQuerySet*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveTrigger4Cache*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveUserFieldsCache*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transFormRelationRecord*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="translateFormula*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateDataState*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateFormFieldBindEnum*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateFormFieldChange*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateFormName*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateRecentReport*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="wrapMenuBOListOfMember*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addTrigger*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="deleteIndexForDelete*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="onDealPageLeave*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="createLog*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transMergeCtpTemplateConfig*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveRecentData4OrgIndex*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="sendPacket*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transCheckBrachSelectedWorkFlow*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateSignleViewTime*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="addTask*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="saveAttachments*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="transSelect*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="insertLog*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateClick*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="lock*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="updateLockTime*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="processIndexDBCache" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="resumeDBIndexInfo" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />

			<tx:method name="move*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="takeBack*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="stepBack*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="stepStop*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />

			<tx:method name="is*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="check*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="find*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="get*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="select*" propagation="SUPPORTS" read-only="true" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="list*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="query*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="on*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="copy*" propagation="SUPPORTS" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />

			<tx:method name="save*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="insert*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="delete*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="update*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="trans*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="test*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="import*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="add*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
			<tx:method name="create*" propagation="REQUIRED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />

			<!-- 表单获取动态表号方法，不需要事务管理 -->
			<tx:method name="getFormTableNumber" propagation="NOT_SUPPORTED" rollback-for="com.seeyon.ctp.common.exceptions.BusinessException" />
		</tx:attributes>
	</tx:advice>

	<bean id="transactionManager" class="org.springframework.orm.hibernate3.CTPTransactionManager">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean id="sessionFactory" class="org.springframework.orm.hibernate3.CTPLocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.show_sql">false</prop>
				<prop key="hibernate.generate_statistics">false</prop>
<!-- 				<prop key="hibernate.hbm2ddl.auto">update</prop> -->
			</props>
		</property>
		<property name="mappingLocations">
			<list>
				<value>classpath*:com/seeyon/apps/**/po/**/*.hbm.xml</value>
				<value>classpath:com/seeyon/apps/**/po/**/*.hbm.xml</value>
				<value>classpath*:com/seeyon/ctp/**/po/**/*.hbm.xml</value>
				<value>classpath:com/seeyon/ctp/**/po/**/*.hbm.xml</value>
				<value>classpath*:com/seeyon/gov/*/po/**/*.hbm.xml</value>
				<value>classpath:com/seeyon/gov/*/po/**/*.hbm.xml</value>
				<value>classpath:com/seeyon/v3x/**/domain/*.hbm.xml</value>
				<value>classpath*:com/seeyon/v3x/**/domain/*.hbm.xml</value>
				<value>classpath*:com/seeyon/cmp/*/po/**/*.hbm.xml</value>
				<value>classpath:com/seeyon/cmp/*/po/**/*.hbm.xml</value>
			</list>
		</property>
	</bean>
	<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>java:comp/env/jdbc/ctpDataSource</value>
		</property>
	</bean>

	<!--
    <bean id="transactionManager"
        class="org.springframework.orm.hibernate3.HibernateTransactionManager">
        <property name="sessionFactory">
            <ref local="sessionFactory" />
        </property>
    </bean>
  	-->
  	<!-- 
    <bean id="baseTxService"
        class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
        abstract="true">
        <property name="transactionManager" ref="transactionManager" />
        <property name="proxyTargetClass" value="true" />

        <property name="transactionAttributes">
            <props>
                <prop key="get*">PROPAGATION_SUPPORTS</prop>
                <prop key="find*">PROPAGATION_SUPPORTS,readOnly</prop>
                <prop key="load*">PROPAGATION_SUPPORTS,readOnly</prop>
                <prop key="add*">PROPAGATION_REQUIRED</prop>
                <prop key="create*">PROPAGATION_REQUIRED</prop>
                <prop key="insert*">PROPAGATION_REQUIRED</prop>                        
                <prop key="update*">PROPAGATION_REQUIRED</prop>
                <prop key="save*">PROPAGATION_REQUIRED</prop>
                <prop key="remove*">PROPAGATION_REQUIRED</prop>
                <prop key="delete">PROPAGATION_REQUIRED</prop>                
        
                <prop key="getRemove*">PROPAGATION_SUPPORTS</prop> 
                <prop key="getProcess*">PROPAGATION_SUPPORTS</prop>              
                <prop key="*">PROPAGATION_SUPPORTS</prop>     
            </props>
        </property>
        <property name="preInterceptors">
	        <list>
	        	<ref bean="methodSecurityInterceptor"/>
	        </list>
        </property>
    </bean>
	-->
    



	<bean id="methodNameResolver" class="org.springframework.web.servlet.mvc.multiaction.ParameterMethodNameResolver">
		<property name="paramName" value="method" />
		<property name="defaultMethodName" value="index" />
	</bean>

	<!-- 定义View -->
	<bean id="viewResolver" class="org.springframework.web.servlet.view.CTPViewResolver">
		<property name="viewClass">
			<value>org.springframework.web.servlet.view.JstlView</value>
		</property>
		<property name="prefix">
			<value>/WEB-INF/jsp/</value>
		</property>
		<property name="suffix">
			<value>.jsp</value>
		</property>
	</bean>

	<bean id="urlMapping" class="org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<ref bean="addinMenuInterceptor" />
				<ref bean="cipURLInterceptor" />
			</list>
		</property>
	</bean>
	<bean id="addinMenuInterceptor" class="com.seeyon.ctp.common.thirdparty.menu.AddinMenuInterceptor"/>
	<bean id="cipURLInterceptor" class="com.seeyon.apps.cip.interceptor.CIPURLInterceptor"/>
	<!-- <bean id="loggerAdvice" class="com.ufida.hap.spring.LoggerAdvice" /> -->

<!--
	<bean id="genericAspect" class="com.seeyon.ctp.common.aspect.GenericAspectBean"/>
   -->
<!-- 	<aop:config>
		<aop:aspect id="scanTransAspect" ref="scanTransMethodBean">
			<aop:pointcut id="tramsMethods" expression="execution(* com.seeyon.apps..*.trans*(..))" />
			<aop:around pointcut-ref="tramsMethods" method="scanTrans" />
		</aop:aspect>
	</aop:config> -->

    <bean id="perfmonLogBean" class="com.seeyon.ctp.monitor.perfmon.OperationLog"/>
    <bean id="scanTransMethodBean" class="com.seeyon.ctp.monitor.codescan.ScanTransMethod"/>

	<mvc:interceptors>
		<!-- <mvc:mapping path="/user/*" /> -->
		<bean class="com.seeyon.ctp.common.spring.CTPHandlerInterceptor" />
		<bean class="com.seeyon.ctp.common.web.ExtendJavascriptInteceptor" />
	</mvc:interceptors>

	<bean scope="prototype" id="hibernateDaoSupport" class="org.springframework.orm.hibernate3.support.CTPHibernateDaoSupport">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<!-- Spring属性配置器，系统环境变量 -->
	<bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"/>

	<!-- 定义语言管理器 -->
	<bean id="localeResolver" class="org.springframework.web.servlet.i18n.SessionLocaleResolver" />
	
	<bean id="i18nResourceManager" class="com.seeyon.ctp.common.i18n.manager.I18nResourceManagerImpl"/>
	<bean name="/ajax.do" class="com.seeyon.ctp.common.service.AjaxController" autowire="byName" />
</beans>